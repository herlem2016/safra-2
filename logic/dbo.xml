<?xml version="1.0" encoding="iso-8859-1" ?>
<Secciones>
  <seguridad>
    <ObtenerFuncionesHabilitadas>      
      <sql>        
        <![CDATA[
            SELECT B.clave_accion clave_funcion FROM  (SELECT clave_cargo FROM administracion WHERE clave_persona=3 AND fecha_termino IS NULL)A INNER JOIN Cargos_Acciones B ON A.clave_cargo=B.clave_cargo;
        ]]>
      </sql>
    </ObtenerFuncionesHabilitadas>       
  </seguridad>

  <comunicados>
    
    <cargar>
      <sql>
        <![CDATA[
            SELECT CONVERT(NVARCHAR(20),A.fecha,113) fecha1, A.*,C.nombre FROM comunicados A INNER JOIN administracion B ON A.clave_administrador=B.clave INNER JOIN Cargos C ON C.clave=B.clave_cargo ORDER BY fecha DESC;
        ]]>
      </sql>
    </cargar>
    
    <Guardar>
      <campo leyenda="Título" db_nombre="titulo" form_nombre="titulo" requerido="true" charsize="300" tipo="string"/>
        <campo leyenda="Descripción" db_nombre="descripcion" form_nombre="descripcion" requerido="true" charsize="300" tipo="string"/>
        <campo leyenda="Clave de Administrador" db_nombre="administrador" form_nombre="administrador" requerido="false" charsize="0" tipo="int" default="7"/>
      <sql>
        <![CDATA[
          INSERT INTO Comunicados(fecha,clave_Administrador,titulo,mensaje) VALUES(GETDATE(),@administrador,@titulo,@descripcion);
          SELECT CONVERT(INT,@@IDENTITY) clave, 1 estatus, 'OK' mensaje;
          INSERT INTO Notificaciones (clave_admin,mensaje,fecha) VALUES(@administrador,'Nuevo Comunicado:' + @titulo,GETDATE());
        ]]>
      </sql>
    </Guardar>
    
    <ObtenerItem>        
        <campo leyenda="Clave de Item" db_nombre="claveItem" form_nombre="claveItem" requerido="true" charsize="0" tipo="int"/>
        <sql>
          <![CDATA[
            SELECT * FROM Comunicados WHERE clave=@claveItem;
          ]]>
        </sql>
    </ObtenerItem>

    
    
  </comunicados>

  <Generico>
  
  <GuardarArchivo_>    
      <campo leyenda="Descripción" db_nombre="descripcion" form_nombre="descripcion" requerido="false" charsize="100" tipo="string" default=""/>
      <campo leyenda="Catalogo" db_nombre="catalogo" form_nombre="catalogo" requerido="true" charsize="100" tipo="string"/>
      <campo leyenda="Clave de item" db_nombre="clave_item" form_nombre="claveItem" requerido="true" charsize="0" tipo="int"/>
      <sql>
        <![CDATA[
            DECLARE @ccatalogo INT;
            SELECT @ccatalogo=indice FROM Catalogos WHERE descripcion like @catalogo;
            INSERT INTO imagenes_catalogos(catalogo,clave,descripcion) VALUES(@ccatalogo,@clave_item,@descripcion);
            SELECT CONVERT(INT,@@IDENTITY) clave, 1 estatus, 'OK' mensaje;
        ]]>
      </sql>
    </GuardarArchivo_>
  
  </Generico>
    

</Secciones>